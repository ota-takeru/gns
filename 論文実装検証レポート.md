# è«–æ–‡å®Ÿè£…æ¤œè¨¼ãƒ¬ãƒãƒ¼ãƒˆ

## Learning to Simulate Complex Physics with Graph Networks (Sanchez-Gonzalez et al., 2020)

ç”Ÿæˆæ—¥: 2025 å¹´ 10 æœˆ 22 æ—¥

---

## ğŸ“‹ ç›®æ¬¡

1. [æ¤œè¨¼æ¦‚è¦](#æ¤œè¨¼æ¦‚è¦)
2. [ãƒ¢ãƒ‡ãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ¤œè¨¼](#ãƒ¢ãƒ‡ãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ¤œè¨¼)
3. [ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ¤œè¨¼](#ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ¤œè¨¼)
4. [å­¦ç¿’è¨­å®šã®æ¤œè¨¼](#å­¦ç¿’è¨­å®šã®æ¤œè¨¼)
5. [å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼](#å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼)
6. [å•é¡Œç‚¹ã¨æ”¹å–„ææ¡ˆ](#å•é¡Œç‚¹ã¨æ”¹å–„ææ¡ˆ)
7. [æ¨å¥¨ã•ã‚Œã‚‹å¤‰æ›´](#æ¨å¥¨ã•ã‚Œã‚‹å¤‰æ›´)

---

## æ¤œè¨¼æ¦‚è¦

æœ¬ãƒ¬ãƒãƒ¼ãƒˆã§ã¯ã€ç¾åœ¨ã® Graph Network-based Simulator (GNS)å®Ÿè£…ãŒè«–æ–‡ã€ŒLearning to Simulate Complex Physics with Graph Networksã€(arXiv:2002.09405)ã®ä»•æ§˜ã«æº–æ‹ ã—ã¦ã„ã‚‹ã‹ã‚’æ¤œè¨¼ã—ã¾ã—ãŸã€‚

### æ¤œè¨¼å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«

- `src/graph_network.py` - ãƒ¢ãƒ‡ãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- `src/learned_simulator.py` - ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚³ã‚¢
- `src/train.py` - å­¦ç¿’ãƒ«ãƒ¼ãƒ—
- `config.yaml` - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
- `datasets/scripts/gen_pymunk.py` - ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ

---

## ãƒ¢ãƒ‡ãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ¤œè¨¼

### âœ… Encode-Process-Decode æ§‹é€ 

ç¾åœ¨ã®å®Ÿè£…ã¯è«–æ–‡ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’**æ­£ã—ãå®Ÿè£…**ã—ã¦ã„ã¾ã™ã€‚

#### 1. ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ (`graph_network.py`: 37-76 è¡Œ)

```python
class Encoder(nn.Module):
    def __init__(self, nnode_in_features, nnode_out_features,
                 nedge_in_features, nedge_out_features,
                 nmlp_layers, mlp_hidden_dim):
        # ãƒãƒ¼ãƒ‰ç‰¹å¾´ã¨ã‚¨ãƒƒã‚¸ç‰¹å¾´ã‚’MLPã§æ½œåœ¨ç©ºé–“ã«ãƒãƒƒãƒ”ãƒ³ã‚°
        self.node_fn = nn.Sequential(
            build_mlp(...),
            nn.LayerNorm(nnode_out_features)  # âœ… LayerNormé©ç”¨
        )
        self.edge_fn = nn.Sequential(
            build_mlp(...),
            nn.LayerNorm(nedge_out_features)  # âœ… LayerNormé©ç”¨
        )
```

**è©•ä¾¡:** âœ… è«–æ–‡é€šã‚Š

#### 2. ãƒ—ãƒ­ã‚»ãƒƒã‚µ (`graph_network.py`: 159-192 è¡Œ)

```python
class Processer(nn.Module):
    def __init__(self, ..., nmessage_passing_steps):
        self.gnn_stack = nn.ModuleList([
            InteractionNetwork(...)
            for _ in range(nmessage_passing_steps)  # âœ… Må›ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ‘ãƒƒã‚·ãƒ³ã‚°
        ])
```

**InteractionNetwork:**

- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é–¢æ•°: ã‚¨ãƒƒã‚¸ç‰¹å¾´ã®æ›´æ–° âœ…
- é›†ç´„é–¢æ•°: sum aggregation âœ…
- æ›´æ–°é–¢æ•°: ãƒãƒ¼ãƒ‰ç‰¹å¾´ã®æ›´æ–° âœ…
- æ®‹å·®æ¥ç¶š: ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ä¸¡æ–¹ã«é©ç”¨ âœ…

**è©•ä¾¡:** âœ… è«–æ–‡é€šã‚Š

#### 3. ãƒ‡ã‚³ãƒ¼ãƒ€ (`graph_network.py`: 194-202 è¡Œ)

```python
class Decoder(nn.Module):
    def __init__(self, nnode_in, nnode_out, nmlp_layers, mlp_hidden_dim):
        self.node_fn = build_mlp(...)  # âœ… MLPã§åŠ é€Ÿåº¦ã‚’äºˆæ¸¬
```

**è©•ä¾¡:** âœ… è«–æ–‡é€šã‚Š

---

## ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ¤œè¨¼

### âœ… å®Œå…¨ã«è«–æ–‡æº–æ‹ 

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿                   | ç¾åœ¨ã®å®Ÿè£… | è«–æ–‡ã®å€¤ | è©•ä¾¡ |
| ---------------------------- | ---------- | -------- | ---- |
| æ½œåœ¨æ¬¡å…ƒ (latent_dim)        | 128        | 128      | âœ…   |
| ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ‘ãƒƒã‚·ãƒ³ã‚°å›æ•° (M) | 10         | 10       | âœ…   |
| MLP å±¤æ•° (nmlp_layers)       | 2          | 2        | âœ…   |
| MLP éš ã‚Œå±¤æ¬¡å…ƒ               | 128        | 128      | âœ…   |
| ç²’å­ã‚¿ã‚¤ãƒ—åŸ‹ã‚è¾¼ã¿           | 16         | 16       | âœ…   |

**å®Ÿè£…ç®‡æ‰€:** `src/train.py` 180-195 è¡Œ

```python
simulator = learned_simulator.LearnedSimulator(
    particle_dimensions=metadata["dim"],
    nnode_in=nnode_in,
    nedge_in=nedge_in,
    latent_dim=128,              # âœ…
    nmessage_passing_steps=10,   # âœ…
    nmlp_layers=2,               # âœ…
    mlp_hidden_dim=128,          # âœ…
    connectivity_radius=metadata["default_connectivity_radius"],
    normalization_stats=normalization_stats,
    nparticle_types=NUM_PARTICLE_TYPES,
    particle_type_embedding_size=16,  # âœ…
    device=device,
)
```

---

## å­¦ç¿’è¨­å®šã®æ¤œè¨¼

### âœ… å­¦ç¿’ç‡ã¨ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚° - æ­£ã—ã„

| è¨­å®šé …ç›®       | ç¾åœ¨ã®å€¤ | è«–æ–‡ã®å€¤ | è©•ä¾¡ |
| -------------- | -------- | -------- | ---- |
| åˆæœŸå­¦ç¿’ç‡     | 1e-4     | 1e-4     | âœ…   |
| å­¦ç¿’ç‡æ¸›è¡°ç‡   | 0.1      | 0.1      | âœ…   |
| æ¸›è¡°ã‚¹ãƒ†ãƒƒãƒ—   | 5e6      | 5e6      | âœ…   |
| ãƒã‚¤ã‚ºæ¨™æº–åå·® | 6.7e-4   | 6.7e-4   | âœ…   |

**å®Ÿè£…ç®‡æ‰€:** `config.yaml`

```yaml
lr_init: 0.0001 # âœ… 1e-4
lr_decay: 0.1 # âœ… æŒ‡æ•°æ¸›è¡°
lr_decay_steps: 5000000 # âœ… 5M steps
noise_std: 0.00067 # âœ… 6.7e-4
```

### âœ… ãƒã‚¤ã‚ºæ³¨å…¥ - æ­£ã—ãå®Ÿè£…

**å®Ÿè£…:** `src/noise_utils.py` & `src/train.py`

```python
# ãƒ©ãƒ³ãƒ€ãƒ ã‚¦ã‚©ãƒ¼ã‚¯ãƒã‚¤ã‚ºã®ç”Ÿæˆ
sampled_noise = noise_utils.get_random_walk_noise_for_position_sequence(
    position, noise_std_last_step=cfg.noise_std
)
# éé‹å‹•å­¦ç²’å­ã®ã¿ã«ãƒã‚¤ã‚ºã‚’é©ç”¨
non_kinematic_mask = (particle_type != KINEMATIC_PARTICLE_ID)
sampled_noise *= non_kinematic_mask.view(-1, 1, 1)  # âœ…
```

**è©•ä¾¡:** âœ… è«–æ–‡é€šã‚Š

### âœ… æ­£è¦åŒ– - æ­£ã—ãå®Ÿè£…

é€Ÿåº¦ã¨åŠ é€Ÿåº¦ã®æ­£è¦åŒ–ã«ãƒã‚¤ã‚ºã®åˆ†æ•£ã‚’è€ƒæ…®ï¼š

```python
normalization_stats = {
    "acceleration": {
        "mean": torch.FloatTensor(metadata["acc_mean"]),
        "std": torch.sqrt(
            torch.FloatTensor(metadata["acc_std"]) ** 2 + acc_noise_std**2
        ),  # âœ… ãƒã‚¤ã‚ºã‚’è€ƒæ…®ã—ãŸåˆ†æ•£
    },
    "velocity": {
        "mean": torch.FloatTensor(metadata["vel_mean"]),
        "std": torch.sqrt(
            torch.FloatTensor(metadata["vel_std"]) ** 2 + vel_noise_std**2
        ),  # âœ… ãƒã‚¤ã‚ºã‚’è€ƒæ…®ã—ãŸåˆ†æ•£
    },
}
```

**è©•ä¾¡:** âœ… è«–æ–‡é€šã‚Š

### âš ï¸ **é‡å¤§ãªå•é¡Œ: å­¦ç¿’ã‚¹ãƒ†ãƒƒãƒ—æ•°ãŒæ¥µç«¯ã«å°‘ãªã„**

| è¨­å®šé …ç›®       | ç¾åœ¨ã®å€¤ | è«–æ–‡ã®å€¤       | é©åˆåº¦      |
| -------------- | -------- | -------------- | ----------- |
| å­¦ç¿’ã‚¹ãƒ†ãƒƒãƒ—æ•° | **100**  | **20,000,000** | **0.0005%** |

**ç¾åœ¨ã®è¨­å®š:** `config.yaml`

```yaml
ntraining_steps: 100 # âŒ ã‚ãšã‹100ã‚¹ãƒ†ãƒƒãƒ—
```

**è«–æ–‡ã®æ¨å¥¨:**

```yaml
ntraining_steps: 20000000 # 2000ä¸‡ã‚¹ãƒ†ãƒƒãƒ—
```

**å½±éŸ¿:**

- ãƒ¢ãƒ‡ãƒ«ãŒå…¨ãå­¦ç¿’ã§ããªã„
- é‡ã¿ãŒã»ã¼ãƒ©ãƒ³ãƒ€ãƒ ã®ã¾ã¾
- è«–æ–‡ã®æ€§èƒ½ã‚’å†ç¾ä¸å¯èƒ½

**è©•ä¾¡:** âŒ **è‡´å‘½çš„ãªè¨­å®šãƒŸã‚¹**

---

## å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼

### âš ï¸ **é‡å¤§ãªå•é¡Œ: ãƒ‡ãƒ¼ã‚¿æ•°ãŒæ¥µç«¯ã«å°‘ãªã„**

#### ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆè¨­å®š

**ãƒ•ã‚¡ã‚¤ãƒ«:** `datasets/scripts/gen_pymunk.py`

```python
num_train_scenes = 10   # âŒ ã‚ãšã‹10ã‚·ãƒ¼ãƒ³
num_valid_scenes = 3    # âŒ ã‚ãšã‹3ã‚·ãƒ¼ãƒ³
```

#### è«–æ–‡ã®æ¨™æº–çš„ãªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ

| ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ    | è»Œè·¡æ•° | ãƒ•ãƒ¬ãƒ¼ãƒ æ•°/è»Œè·¡ | ç·ã‚µãƒ³ãƒ—ãƒ«æ•° |
| --------------- | ------ | --------------- | ------------ |
| WaterDropSample | 1,000  | ~320            | ~320,000     |
| Sand            | 1,000  | ~320            | ~320,000     |
| Goop            | 1,000  | ~320            | ~320,000     |
| **ç¾åœ¨ã®å®Ÿè£…**  | **10** | **240**         | **~2,400**   |

**ãƒ‡ãƒ¼ã‚¿é‡ã®æ¯”è¼ƒ:**

- è«–æ–‡: ç´„ 32 ä¸‡ã‚µãƒ³ãƒ—ãƒ«
- ç¾åœ¨: ç´„ 2,400 ã‚µãƒ³ãƒ—ãƒ«
- **æ¯”ç‡: 0.75%ï¼ˆ133 åˆ†ã® 1ï¼‰**

**å½±éŸ¿:**

1. **éå­¦ç¿’ã®å±é™ºæ€§ãŒæ¥µã‚ã¦é«˜ã„**

   - 10 ã‚·ãƒ¼ãƒ³ã ã‘ã§ã¯ç‰©ç†ç¾è±¡ã®å¤šæ§˜æ€§ã‚’æ‰ãˆã‚‰ã‚Œãªã„
   - ãƒ¢ãƒ‡ãƒ«ãŒè¨“ç·´ãƒ‡ãƒ¼ã‚¿ã‚’æš—è¨˜ã—ã¦ã—ã¾ã†

2. **æ±åŒ–æ€§èƒ½ã®è‘—ã—ã„ä½ä¸‹**

   - æœªçŸ¥ã®åˆæœŸæ¡ä»¶ã«å¯¾å¿œã§ããªã„
   - ç²’å­æ•°ã‚„é…ç½®ãŒå¤‰ã‚ã‚‹ã¨äºˆæ¸¬ãŒç ´ç¶»

3. **ãƒ­ãƒã‚¹ãƒˆæ€§ã®æ¬ å¦‚**
   - ã‚ãšã‹ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¤‰åŒ–ã§æ€§èƒ½ãŒå¤§å¹…ã«ä½ä¸‹

**è©•ä¾¡:** âŒ **è‡´å‘½çš„ãªãƒ‡ãƒ¼ã‚¿ä¸è¶³**

### âœ… ãã®ä»–ã®ãƒ‡ãƒ¼ã‚¿è¨­å®š

| é …ç›®           | ç¾åœ¨ã®è¨­å®š      | è©•ä¾¡                 |
| -------------- | --------------- | -------------------- |
| ã‚·ãƒ¼ã‚±ãƒ³ã‚¹é•·   | 240 ãƒ•ãƒ¬ãƒ¼ãƒ     | âœ… å¦¥å½“ï¼ˆ2 ç§’é–“ï¼‰    |
| ã‚¿ã‚¤ãƒ ã‚¹ãƒ†ãƒƒãƒ— | 1/120 ç§’        | âœ… å¦¥å½“              |
| å‰›ä½“æ•°         | 2-5 å€‹          | â–³ ã‚‚ã£ã¨å¤šæ§˜åŒ–ã™ã¹ã |
| ç²’å­å¯†åº¦       | 16 points/shape | âœ… å¦¥å½“              |

### â–³ Connectivity Radius ã®æ¨å®š

**ç¾åœ¨ã®å®Ÿè£…:** `gen_pymunk.py` 251 è¡Œ

```python
return float(np.percentile(all_nn, 90) * 1.5)
```

**è«–æ–‡ã®æ¨å¥¨:**

- ç²’å­é–“è·é›¢ã® 2-3 å€

**è©•ä¾¡:** â–³ ã‚„ã‚„å°ã•ã„å¯èƒ½æ€§ï¼ˆ1.5 å€ â†’ 2.0 å€ã‚’æ¨å¥¨ï¼‰

---

## å•é¡Œç‚¹ã¨æ”¹å–„ææ¡ˆ

### ğŸ”´ **è‡´å‘½çš„ãªå•é¡Œï¼ˆå³åº§ã«ä¿®æ­£ãŒå¿…è¦ï¼‰**

#### 1. å­¦ç¿’ã‚¹ãƒ†ãƒƒãƒ—æ•°ã®ä¸è¶³

**ç¾çŠ¶:** 100 ã‚¹ãƒ†ãƒƒãƒ—
**å¿…è¦:** 20,000,000 ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆæœ€ä½ã§ã‚‚ 1,000,000 ä»¥ä¸Šï¼‰

**ç†ç”±:**

- GNS ã®ã‚ˆã†ãªè¤‡é›‘ãªã‚°ãƒ©ãƒ•ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯å¤§é‡ã®å­¦ç¿’ãŒå¿…è¦
- 100 ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯å‹¾é…é™ä¸‹æ³•ãŒã»ã¨ã‚“ã©æ©Ÿèƒ½ã—ãªã„
- è«–æ–‡ã® 20,000,000 ã‚¹ãƒ†ãƒƒãƒ—ã¯ååˆ†ãªåæŸã®ãŸã‚ã«å¿…è¦

**æ¨å¥¨ä¿®æ­£:**

```yaml
# config.yaml
ntraining_steps: 20000000 # ã¾ãŸã¯æœ€ä½ã§ã‚‚ 1000000
nsave_steps: 50000 # ä¿å­˜é–“éš”ã‚‚èª¿æ•´
```

#### 2. å­¦ç¿’ãƒ‡ãƒ¼ã‚¿æ•°ã®ä¸è¶³

**ç¾çŠ¶:** 10 ã‚·ãƒ¼ãƒ³ï¼ˆè¨“ç·´ï¼‰ã€3 ã‚·ãƒ¼ãƒ³ï¼ˆæ¤œè¨¼ï¼‰
**å¿…è¦:** 1,000 ã‚·ãƒ¼ãƒ³ä»¥ä¸Šï¼ˆè¨“ç·´ï¼‰ã€100 ã‚·ãƒ¼ãƒ³ä»¥ä¸Šï¼ˆæ¤œè¨¼ï¼‰

**ç†ç”±:**

- ç‰©ç†ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¯å¤šæ§˜ãªåˆæœŸæ¡ä»¶ãŒå¿…è¦
- 10 ã‚·ãƒ¼ãƒ³ã§ã¯æ±åŒ–æ€§èƒ½ãŒå…¨ãå¾—ã‚‰ã‚Œãªã„
- éå­¦ç¿’ãŒç¢ºå®Ÿã«ç™ºç”Ÿã™ã‚‹

**æ¨å¥¨ä¿®æ­£:**

```python
# datasets/scripts/gen_pymunk.py
num_train_scenes = 1000   # æœ€ä½1000ã‚·ãƒ¼ãƒ³
num_valid_scenes = 100    # æœ€ä½100ã‚·ãƒ¼ãƒ³
num_test_scenes = 100     # ãƒ†ã‚¹ãƒˆã‚»ãƒƒãƒˆã‚‚è¿½åŠ 
```

---

### ğŸŸ¡ **æ¨å¥¨ã•ã‚Œã‚‹æ”¹å–„ï¼ˆã‚ˆã‚Šè‰¯ã„çµæœã®ãŸã‚ï¼‰**

#### 3. ãƒãƒƒãƒã‚µã‚¤ã‚ºã®å¢—åŠ 

**ç¾çŠ¶:** 2
**æ¨å¥¨:** 4-8ï¼ˆGPU ãƒ¡ãƒ¢ãƒªæ¬¡ç¬¬ï¼‰

```yaml
# config.yaml
batch_size: 4 # ãƒ¡ãƒ¢ãƒªãŒè¨±ã›ã°
```

#### 4. Connectivity Radius ã®èª¿æ•´

**ç¾çŠ¶:** 90 ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ« Ã— 1.5
**æ¨å¥¨:** 90 ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ« Ã— 2.0

```python
# datasets/scripts/gen_pymunk.py (251è¡Œ)
return float(np.percentile(all_nn, 90) * 2.0)  # 1.5 â†’ 2.0
```

#### 5. ãƒ‡ãƒ¼ã‚¿ã®å¤šæ§˜æ€§å‘ä¸Š

**å‰›ä½“æ•°ã®ç¯„å›²æ‹¡å¤§:**

```python
# gen_pymunk.py (113è¡Œ)
def generate_scene(T=240, dt=1/120, substeps=4,
                   n_bodies=(2, 10),  # 2-5 â†’ 2-10ã«æ‹¡å¤§
                   density=16):
```

**ç‰©ç†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å¤šæ§˜åŒ–:**

```python
# æ‘©æ“¦ä¿‚æ•°ã®ç¯„å›²æ‹¡å¤§
shape.friction = RNG.uniform(0.1, 1.0)  # 0.2-0.9 â†’ 0.1-1.0

# å¼¾æ€§ä¿‚æ•°ã®ç¯„å›²æ‹¡å¤§
shape.elasticity = RNG.uniform(0.0, 0.6)  # 0.0-0.4 â†’ 0.0-0.6

# è³ªé‡ã®ç¯„å›²æ‹¡å¤§
mass = RNG.uniform(0.3, 5.0)  # 0.5-3.0 â†’ 0.3-5.0
```

#### 6. æ¤œè¨¼é–“éš”ã®è¨­å®š

ç¾åœ¨ã¯`validation_interval: null`ã§ã™ãŒã€å­¦ç¿’ã®é€²æ—ç¢ºèªã®ãŸã‚è¨­å®šã‚’æ¨å¥¨ï¼š

```yaml
# config.yaml
validation_interval: 5000 # 5000ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã«æ¤œè¨¼
```

---

## æ¨å¥¨ã•ã‚Œã‚‹å¤‰æ›´

### å„ªå…ˆåº¦ 1: å³åº§ã«ä¿®æ­£ã™ã¹ãé …ç›®

#### âœï¸ å¤‰æ›´ 1: `config.yaml`ã®ä¿®æ­£

```yaml
mode: train
data_path: ./datasets/out/
model_path: ./models/
output_path: ./rollouts/
output_filename: rollout

batch_size: 4 # 2 â†’ 4
noise_std: 0.00067 # âœ… å¤‰æ›´ãªã—

# ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°
ntraining_steps: 20000000 # âŒ 100 â†’ âœ… 20000000
validation_interval: 5000 # âŒ null â†’ âœ… 5000
nsave_steps: 50000 # âŒ 50 â†’ âœ… 50000

# å­¦ç¿’ç‡ï¼ˆæŒ‡æ•°æ¸›è¡°ï¼‰
lr_init: 0.0001 # âœ… å¤‰æ›´ãªã—
lr_decay: 0.1 # âœ… å¤‰æ›´ãªã—
lr_decay_steps: 5000000 # âœ… å¤‰æ›´ãªã—

# å†é–‹é–¢é€£
model_file: null
train_state_file: null

# GPUé¸æŠ
cuda_device_number: null
```

#### âœï¸ å¤‰æ›´ 2: `datasets/scripts/gen_pymunk.py`ã®ä¿®æ­£

```python
if __name__ == "__main__":
    out_root = Path(__file__).resolve().parents[1] / "out"

    # Train ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®ç”Ÿæˆ
    num_train_scenes = 1000  # âŒ 10 â†’ âœ… 1000
    split = "train"
    trajectories = []
    last_meta = None
    print(f"Generating {num_train_scenes} training scenes...")
    for i in range(num_train_scenes):
        pos, rigid_ids, meta = generate_scene()
        save_npz(out_root, i, pos, rigid_ids, meta, split=split)
        trajectories.append(_extract_dynamic_positions(pos, rigid_ids, meta["nb"]))
        last_meta = meta

    if trajectories and last_meta is not None:
        dataset_path, meta_path = export_dataset(
            trajectories, out_root, split=split, dt=last_meta["dt"]
        )
        print(f"Saved train dataset to {dataset_path}")
        print(f"Wrote metadata to {meta_path}")
    print(f"Generated {num_train_scenes} scenes in {out_root / split}")

    # Valid ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®ç”Ÿæˆ
    num_valid_scenes = 100  # âŒ 3 â†’ âœ… 100
    split = "valid"
    trajectories = []
    last_meta = None
    print(f"\nGenerating {num_valid_scenes} validation scenes...")
    for i in range(num_valid_scenes):
        pos, rigid_ids, meta = generate_scene()
        save_npz(out_root, i, pos, rigid_ids, meta, split=split)
        trajectories.append(_extract_dynamic_positions(pos, rigid_ids, meta["nb"]))
        last_meta = meta

    if trajectories and last_meta is not None:
        dataset_path, _ = export_dataset(
            trajectories, out_root, split=split, dt=last_meta["dt"]
        )
        print(f"Saved valid dataset to {dataset_path}")
    print(f"Generated {num_valid_scenes} scenes in {out_root / split}")

    # Test ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®ç”Ÿæˆï¼ˆè¿½åŠ ï¼‰
    num_test_scenes = 100
    split = "test"
    trajectories = []
    last_meta = None
    print(f"\nGenerating {num_test_scenes} test scenes...")
    for i in range(num_test_scenes):
        pos, rigid_ids, meta = generate_scene()
        save_npz(out_root, i, pos, rigid_ids, meta, split=split)
        trajectories.append(_extract_dynamic_positions(pos, rigid_ids, meta["nb"]))
        last_meta = meta

    if trajectories and last_meta is not None:
        dataset_path, _ = export_dataset(
            trajectories, out_root, split=split, dt=last_meta["dt"]
        )
        print(f"Saved test dataset to {dataset_path}")
    print(f"Generated {num_test_scenes} scenes in {out_root / split}")
```

#### âœï¸ å¤‰æ›´ 3: Connectivity Radius ã®èª¿æ•´

```python
def _estimate_connectivity_radius(trajectories):
    """Heuristic connectivity radius based on nearest-neighbour distance."""
    # ... (æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰)

    all_nn = np.concatenate(nearest_distances, axis=0)
    # Use a generous multiplier so that the message graph connects over shapes.
    return float(np.percentile(all_nn, 90) * 2.0)  # âŒ 1.5 â†’ âœ… 2.0
```

---

### å„ªå…ˆåº¦ 2: æ¨å¥¨ã•ã‚Œã‚‹æ”¹å–„

#### âœï¸ å¤‰æ›´ 4: ãƒ‡ãƒ¼ã‚¿å¤šæ§˜æ€§ã®å‘ä¸Š

```python
def generate_scene(T=240, dt=1/120, substeps=4,
                   n_bodies=(2, 10),  # âŒ (2, 5) â†’ âœ… (2, 10)
                   density=16):
    # ...

def add_random_rigid(space, x_range=(-3, 3), y=5.0):
    kind = RNG.choice(["box", "circle"])
    mass = RNG.uniform(0.3, 5.0)  # âŒ (0.5, 3.0) â†’ âœ… (0.3, 5.0)
    if kind == "box":
        w, h = RNG.uniform(0.3, 0.8), RNG.uniform(0.3, 0.8)
        # ...
    else:
        r = RNG.uniform(0.2, 0.5)
        # ...

    shape.friction = RNG.uniform(0.1, 1.0)      # âŒ (0.2, 0.9) â†’ âœ… (0.1, 1.0)
    shape.elasticity = RNG.uniform(0.0, 0.6)    # âŒ (0.0, 0.4) â†’ âœ… (0.0, 0.6)
    # ...
```

---

## ğŸ“Š ä¿®æ­£å‰å¾Œã®æ¯”è¼ƒ

### å­¦ç¿’è¨­å®šã®æ¯”è¼ƒ

| é …ç›®           | ä¿®æ­£å‰ | ä¿®æ­£å¾Œ     | è«–æ–‡ã®å€¤      |
| -------------- | ------ | ---------- | ------------- |
| å­¦ç¿’ã‚¹ãƒ†ãƒƒãƒ—æ•° | 100    | 20,000,000 | 20,000,000 âœ… |
| ä¿å­˜é–“éš”       | 50     | 50,000     | -             |
| ãƒãƒƒãƒã‚µã‚¤ã‚º   | 2      | 4          | 2-4 âœ…        |
| æ¤œè¨¼é–“éš”       | ãªã—   | 5,000      | -             |

### ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®æ¯”è¼ƒ

| é …ç›®                 | ä¿®æ­£å‰ | ä¿®æ­£å¾Œ   | è«–æ–‡ã®æ¨™æº–  |
| -------------------- | ------ | -------- | ----------- |
| è¨“ç·´ã‚·ãƒ¼ãƒ³æ•°         | 10     | 1,000    | 1,000 âœ…    |
| æ¤œè¨¼ã‚·ãƒ¼ãƒ³æ•°         | 3      | 100      | 100 âœ…      |
| ãƒ†ã‚¹ãƒˆã‚·ãƒ¼ãƒ³æ•°       | 0      | 100      | 100 âœ…      |
| ç·ã‚µãƒ³ãƒ—ãƒ«æ•°ï¼ˆæ¨å®šï¼‰ | ~2,400 | ~240,000 | ~320,000 âœ… |

### å­¦ç¿’æ™‚é–“ã®æ¨å®š

**ä¿®æ­£å‰:**

- 100 ã‚¹ãƒ†ãƒƒãƒ— Ã— 2 ãƒãƒƒãƒã‚µã‚¤ã‚º = ç´„ 1 åˆ†

**ä¿®æ­£å¾Œ:**

- 20,000,000 ã‚¹ãƒ†ãƒƒãƒ— Ã— 4 ãƒãƒƒãƒã‚µã‚¤ã‚º
- GPU (RTX 3090 ç›¸å½“): ç´„ 3-7 æ—¥
- è«–æ–‡é€šã‚Šã®æœ¬æ ¼çš„ãªå­¦ç¿’

---

## âœ… çµè«–

### ç¾åœ¨ã®å®Ÿè£…ã®è©•ä¾¡

**âœ… å„ªã‚Œã¦ã„ã‚‹ç‚¹:**

1. **ãƒ¢ãƒ‡ãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: è«–æ–‡é€šã‚Šã«å®Œç’§ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ï¼ˆ100%é©åˆï¼‰
2. **ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**: ã™ã¹ã¦è«–æ–‡ã®æ¨å¥¨å€¤ï¼ˆ100%é©åˆï¼‰
3. **ãƒã‚¤ã‚ºæ³¨å…¥**: æ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
4. **æ­£è¦åŒ–**: è«–æ–‡é€šã‚Šã®å®Ÿè£…
5. **ã‚°ãƒ©ãƒ•æ§‹ç¯‰**: é©åˆ‡ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹

**âŒ è‡´å‘½çš„ãªå•é¡Œ:**

1. **å­¦ç¿’ã‚¹ãƒ†ãƒƒãƒ—æ•°**: ã‚ãšã‹ 100ï¼ˆè«–æ–‡ã® 0.0005%ï¼‰
2. **å­¦ç¿’ãƒ‡ãƒ¼ã‚¿æ•°**: ã‚ãšã‹ 10 ã‚·ãƒ¼ãƒ³ï¼ˆè«–æ–‡ã® 1%ï¼‰

**ç·åˆè©•ä¾¡:**

- **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å®Ÿè£…: A+ (å®Œç’§)**
- **å­¦ç¿’è¨­å®š: F (ä¸åˆæ ¼)**
- **ç·åˆ: D (è¦å¤§å¹…ä¿®æ­£)**

### æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

**å³åº§ã«å®Ÿè¡Œã™ã¹ã:**

1. `config.yaml`ã®`ntraining_steps`ã‚’ 20,000,000 ã«å¤‰æ›´
2. `gen_pymunk.py`ã®ã‚·ãƒ¼ãƒ³æ•°ã‚’ 1,000/100/100 ã«å¤‰æ›´
3. ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’å†ç”Ÿæˆ
4. é•·æœŸé–“ï¼ˆæ•°æ—¥ï¼‰ã®å­¦ç¿’ã‚’å®Ÿè¡Œ

**ã“ã‚Œã‚‰ã®ä¿®æ­£ã«ã‚ˆã‚Šã€è«–æ–‡ã®æ€§èƒ½ã‚’å†ç¾ã§ãã‚‹å¯èƒ½æ€§ãŒé«˜ã¾ã‚Šã¾ã™ã€‚**

---

## ğŸ“š å‚è€ƒè³‡æ–™

1. Sanchez-Gonzalez, A., et al. (2020). "Learning to Simulate Complex Physics with Graph Networks." arXiv:2002.09405
2. è«–æ–‡ã® Appendix A: å®Ÿè£…ã®è©³ç´°
3. è«–æ–‡ã® Table 1: ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸€è¦§

---

**ä½œæˆè€…:** AI Assistant  
**æ¤œè¨¼æ—¥:** 2025 å¹´ 10 æœˆ 22 æ—¥  
**å¯¾è±¡å®Ÿè£…:** /home/takeru/python/gns
