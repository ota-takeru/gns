mode: rollout # 推論モード

# 入出力パス
data_path: ./datasets/out/ # test.npz を置くディレクトリ
scenario: fluid
scenario_options:
  rigid:
    dataset: ./datasets/out
    description: Default planar rigid-body scenes
  fluid:
    dataset: ./datasets/out_fluid/tank_sloshing_mid_800
    rollout_dataset: valid
    description: PySPH-based dam break fluid dataset
method: gns
method_options:
  hamiltonian_sph:
    particle_mass: null # 未指定ならメタデータから自動推定
    sph:
      # 粒子間隔0.12・rc≈0.32（=2*h）の想定で近傍数を ~20 に増やす
      smoothing_length: 0.16 # 2*h がカットオフ半径（約0.32）
      max_num_neighbors: 128
    conservative:
      mlp_layers: 2
      mlp_hidden_dim: 128
      dropout: 0.0
      phi_max_multiplier: 2.0
      use_density: false
    dissipation:
      mlp_layers: 2
      mlp_hidden_dim: 128
      dropout: 0.0
      alpha_max: 1.0
      s_clip_scaled: 5.0
    terms:
      enable_central: true
      enable_pressure: false
      enable_contact: true
      enable_damping: true
      w_central: 1.0
      w_pressure: 1.0
      w_contact: 1.0
      w_damping: 1.0
    pressure:
      enabled: true
      mlp_layers: 2
      mlp_hidden_dim: 128
      dropout: 0.0
      rep_max_multiplier: 2.0
      use_compression_gate: true
    contact:
      enabled: true
      mlp_layers: 2
      mlp_hidden_dim: 128
      dropout: 0.0
      alpha_max: 10.0
      s_clip_scaled: 50.0
    wall:
      enabled: false # 壁MLP項を無効化（壁由来の加速度をオフ）
    wall_particles:
      enabled: true
      particle_type_id: 3
      freeze_walls: true
      zero_wall_acceleration: true
      disable_wall_mlp: true
      disable_rollout_reflection: true
    cutoff:
      kind: cosine
    integrator:
      dt: 0.006
      type: leapfrog # leapfrog|symplectic_euler
    gravity: [0.0, -9.81] # 2D データセットに合わせる
    include_external_acceleration: true
    pos_feature_scale: null # null で半径を使用
    vel_feature_scale: null # null で pos_feature_scale/dt
model_path: ./models/ # 学習済みモデルの格納先
# Kaggle で Add data を使う場合は /kaggle/input/<dataset-name>/models などに置き換える
output_path: ./rollouts/ # 推論結果(pklなど)の出力先
output_filename: rollout # 出力ファイル名の接頭辞

# 使用するモデル（null で latest を使用）
model_file: null

# 推論（rollout）時の制御
rollout_inference_max_examples: 1 # 生成するシーン（pkl）数の上限。null で全件
rollout_max_steps: null # ロールアウト生成時の最大ステップ数(null で軌道全体)
train_max_steps_per_trajectory: null
valid_max_steps_per_trajectory: null
noise_std: 0.0003 # 正規化統計用のノイズ設定（推論で参照）
noise: random_walk
loss: acceleration
cuda_device_number: null # null で自動選択
