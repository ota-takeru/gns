# 可視化結果の見方

## HTML ファイルの開き方

以下の HTML ファイルを Web ブラウザで開いてください:

- `rollouts/rollout_ex0.html`
- `rollouts/rollout_ex1.html`
- `rollouts/rollout_ex2.html`

## 表示内容

### 2 つのパネル

HTML ファイルには 2 つのアニメーションパネルが並んで表示されます:

1. **左側: Predicted（予測）**

   - GNS モデルが予測した粒子の動き
   - 学習が不十分な場合、実際の動きと異なることがあります

2. **右側: Ground Truth（正解）**
   - 物理シミュレーション（Pymunk）による正しい粒子の動き
   - これが正解データです

### 粒子と壁の表示

- **青い小さな点**: 落下する剛体の粒子（2-5 個の剛体）
  - 各剛体は複数の粒子で表現されています
  - 粒子サイズは小さく調整されており、重ならずに見やすくなっています
- **グレーの線**: 壁の位置を示す境界線
  - 床: y = 0（横の線）
  - 左壁: x = -5（左の縦線）
  - 右壁: x = 5（右の縦線）

### 可視化の改善点（最新版）

✅ **粒子サイズの縮小**: 20 → 5 に変更して重なりを解消  
✅ **図のサイズ拡大**: 14x6 → 16x8 に拡大して見やすく  
✅ **壁の可視化**: グレーの線で壁の位置を明示  
✅ **透明度の調整**: alpha=0.8 で粒子がより鮮明に  
✅ **軸ラベル追加**: x 軸、y 軸のラベルを追加  
✅ **グリッド改善**: より細かく見やすいグリッド線

### コントロール

画面下部のコントロールパネルで以下の操作ができます:

- ⏮ **First frame**: 最初のフレームに戻る
- ⏪ **Previous frame**: 前のフレームに戻る
- ⏸ **Pause**: アニメーションを一時停止
- ▶ **Play**: アニメーションを再生
- ⏭ **Next frame**: 次のフレームに進む
- ⏩ **Last frame**: 最後のフレームに進む
- ➕ **Faster**: 再生速度を上げる
- ➖ **Slower**: 再生速度を下げる

### 再生モード

- **Once**: 1 回だけ再生
- **Loop**: 繰り返し再生（デフォルト）
- **Reflect**: 往復再生

## 確認ポイント

### 1. 初期状態（フレーム 0）

- 剛体が上部に配置されています
- 複数の剛体が見えるはずです

### 2. 落下（中間フレーム）

- 剛体が重力で落下します
- 壁（境界）に衝突して跳ね返る様子が見られます

### 3. 予測 vs 正解の比較

- **学習が進んでいる場合**: 左右のパネルの動きがほぼ一致
- **学習が不十分な場合**: 左右のパネルの動きが大きく異なる
  - 現在は 100 ステップしか学習していないため、予測が不正確です
  - より長い学習（例: 10,000 ステップ以上）で改善できます

## 注意事項

### 壁が表示されない理由

学習データには**動的な粒子のみ**が含まれており、壁の粒子は除外されています。

- **元のシミュレーションデータ**: 動的粒子 + 壁の粒子（例: 32 + 48 = 80 粒子）
- **学習・推論データ**: 動的粒子のみ（例: 32 粒子）

これは、GNS モデルが動的な物体の動きを学習することに焦点を当てているためです。
壁は固定されているため、モデルが学習する必要がありません。

### 境界条件

壁は表示されませんが、以下の位置に**暗黙的に存在**しています:

- **床**: y = 0
- **左壁**: x = -5
- **右壁**: x = 5

粒子がこれらの位置で跳ね返る様子が観察できます。

## より良い可視化のために

もし壁も含めた完全な可視化が必要な場合は、元のシーンデータ（`datasets/out/valid/scene_*.npz`）を
直接可視化するスクリプトを作成することもできます。

例:

```python
import numpy as np
import matplotlib.pyplot as plt
import matplotlib.animation as animation

# シーンデータを読み込む
data = np.load('datasets/out/valid/scene_000.npz')
positions = data['position']  # (T, N_all, 2) - 壁を含む全粒子
rigid_ids = data['rigid_id']

# 動的粒子と壁を色分けして表示
# ...
```

## トラブルシューティング

### HTML ファイルが開けない

- ブラウザが古い場合、最新のブラウザ（Chrome, Firefox, Edge 等）を使用してください

### アニメーションが動かない

- ブラウザの JavaScript が有効になっているか確認してください
- フレーム画像のディレクトリ（`rollout_ex*_frames/`）が同じ場所にあるか確認してください

### 画像が表示されない

- HTML ファイルと同じディレクトリにフレーム画像のフォルダがあるか確認してください
- ファイルパスが正しいか確認してください
